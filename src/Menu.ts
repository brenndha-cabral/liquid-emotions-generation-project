import read from "readline-sync";
import { dataMenu } from "./utils/dataMenu";
import { dataTypesPotions } from "./utils/dataTypesPotions";
import { PotionController } from "./controllers/PotionController";
import { LovePotion } from "./models/LovePotion";
import { ChaosPotion } from "./models/ChaosPotion";
import { MelancholyPotion } from "./models/MelancholyPotion";
import { CouragePotion } from "./models/CouragePotion";
import { TimeDilationPotion } from "./models/TimeDistortionPotion";
import { registerDataPotions } from "./utils/dataPotions";

export function menu() {

    let potions: PotionController = new PotionController();
    let inputOperation: number;
    let type: number;
    let id: number;
    let quantity, price, romanticIntensity, destructionLevel, effectDuration, emotionalDepth, audacityBonus, timeDilationFactor: number;
    let name, description, flavor, principalEffect, sideEffects, howToUse, ingredients, target, memoryTrigger, sideEffect, possibleParadoxes, typeDescription: string;

    try {
        // Teste de simula√ß√£o para n√£o ficar imputando na m√£o no console
        registerDataPotions(potions);
        // Final do input das po√ß√µes
    
    
        while (true) {
    
            console.log(`
*****************************************************

        üîÆ Po√ß√µes - Emo√ß√µes L√≠quidas üîÆ
           O que voc√™ quer fazer hoje?

*****************************************************
    
${dataMenu.map((operation) =>`‚ú® ${operation.code} - ${operation.description}`).join('\n')}
    
*****************************************************`);
    
            console.log("Entre com a op√ß√£o desejada: ");
            inputOperation = read.questionInt();
            const operation = dataMenu.find((operation) => operation.code === inputOperation);
    
            if (!operation) {
                console.log("\nOpera√ß√£o n√£o existe, por favor, escolha uma op√ß√£o v√°lida: ");
                continue;
            }
    
            if (operation.code === 6) {
                console.log("\nüßô O Botic√°rio agradece seu contato, volte sempre! üßô ");
                process.exit(0);
                /* encerra o programa manualmente (se houver c√≥digo abaixo fora do escopo n√£o vai mais rodar, e o arg √© um c√≥digo de sa√≠da
                 o 0 por exemplo significa sa√≠da sem erros, se fosse 1 seria com erro gen√©rico e existem outros c√≥digos tamb√©m) */
            }
    
            switch (operation.code) {
                case 1:
    
                    console.log(`Digite o tipo da po√ß√£o: 
${dataTypesPotions.map((type) => `üîÆ ${type.code} - ${type.description}`).join('\n')}`);
                    type = read.questionInt();
    
                    id = potions.generateIdPotion();
    
                    console.log("Digite o nome: ");
                    name = read.question();
    
                    console.log("Digite a descri√ß√£o: ");
                    description = read.question();
    
                    console.log("Digite a quantidade (numeral): ");
                    quantity = read.questionInt();
    
                    console.log("Digite o sabor: ");
                    flavor = read.question();
    
                    console.log("Digite o efeito principal: ");
                    principalEffect = read.question();
    
                    console.log("Digite os efeitos colaterais: ");
                    sideEffects = read.question();
    
                    console.log("Digite como usar: ");
                    howToUse = read.question();
    
                    console.log("Digite os ingredientes: ");
                    ingredients = read.question();
    
                    console.log("Digite o pre√ßo: ");
                    price = read.questionFloat();
    
                    switch (type) {
                        
                        
                        case 1:
                            console.log("Digite a intensidade rom√¢ntica 1-10: ");
                            romanticIntensity = read.questionInt();
                            
                            console.log("Digite o seu alvo (Pessoa) - N√£o obrigat√≥rio: ");
                            target = read.question();
    
                            typeDescription = dataTypesPotions.find(t => t.code === type)?.description || "";
    
                            potions.registerPotion(
                                new LovePotion(id, name, description, typeDescription, quantity, flavor, principalEffect, sideEffects, howToUse, ingredients, price, romanticIntensity, target)
                            );
                            break;
                        
                        case 2:
                            console.log("Digite o n√≠vel de destrui√ß√£o 1-10: ");
                            destructionLevel = read.questionInt();
    
                            console.log("Digite a dura√ß√£o do efeito 1-5: ");
                            effectDuration = read.questionInt();
    
                            typeDescription = dataTypesPotions.find(t => t.code === type)?.description || "";
    
                            potions.registerPotion(
                                new ChaosPotion(id, name, description, typeDescription, quantity, flavor, principalEffect, sideEffects, howToUse, ingredients, price, destructionLevel, effectDuration)
                            );
                            break;
                        
                        case 3:
                            console.log("Digite a profundidade emocional 1-5: ");
                            emotionalDepth = read.questionInt();
    
                            console.log("Digite os gatilhos: ");
                            memoryTrigger = read.question();
    
                            typeDescription = dataTypesPotions.find(t => t.code === type)?.description || "";
    
                            potions.registerPotion(
                                new MelancholyPotion(id, name, description, typeDescription, quantity, flavor, principalEffect, sideEffects, howToUse, ingredients, price, emotionalDepth, memoryTrigger)
                            );
                            break;
                        
                        case 4:
                            console.log("Digite o b√¥nus de aud√°cia: 1-10");
                            audacityBonus = read.questionInt();
    
                            console.log("Digite os efeitos: ");
                            sideEffect = read.question();
    
                            typeDescription = dataTypesPotions.find(t => t.code === type)?.description || "";
    
                            potions.registerPotion(
                                new CouragePotion(id, name, description, typeDescription, quantity, flavor, principalEffect, sideEffects, howToUse, ingredients, price, audacityBonus, sideEffect)
                            );
                            break;
                        
                        case 5:
                            console.log("Digite o fator dilata√ß√£o: 1-5");
                            timeDilationFactor = read.questionInt();
    
                            console.log("Digite os paradoxos poss√≠veis: ");
                            possibleParadoxes = read.question();
    
                            typeDescription = dataTypesPotions.find(t => t.code === type)?.description || "";
    
                            potions.registerPotion(
                                new TimeDilationPotion(id, name, description, typeDescription, quantity, flavor, principalEffect, sideEffects, howToUse, ingredients, price, timeDilationFactor, possibleParadoxes)
                            );
                            break;
                    }
    
                    break;
    
                case 2:
                    potions.listAllPotions();
                    break;
                
                case 3:
                    console.log("Digite o n√∫mero da po√ß√£o: ");
                    id = read.questionInt();
    
                    potions.findPotionById(id);
                    break;
                
                case 4:
                    console.log("Digite o n√∫mero da po√ß√£o: ");
                    id = read.questionInt();
    
                    let potion = potions.potionById(id);
    
                    if (!!potion) {
                    
                        typeDescription = potion.type;
    
                        console.log("Digite o nome: ");
                        name = read.question();
    
                        console.log("Digite a descri√ß√£o: ");
                        description = read.question();
    
                        console.log("Digite a quantidade: (numeral)");
                        quantity = read.questionInt();
    
                        console.log("Digite o sabor: ");
                        flavor = read.question();
    
                        console.log("Digite o efeito principal: ");
                        principalEffect = read.question();
    
                        console.log("Digite os efeitos colaterais: ");
                        sideEffects = read.question();
    
                        console.log("Digite como usar: ");
                        howToUse = read.question();
    
                        console.log("Digite os ingredientes: ");
                        ingredients = read.question();
    
                        console.log("Digite o pre√ßo: ");
                        price = read.questionFloat();
    
                        switch (typeDescription) {
                            
                            case "Po√ß√µes de Afeto":
                                console.log("Digite a intensidade rom√¢ntica: 1-10");
                                romanticIntensity = read.questionInt();
                                
                                console.log("Digite o seu alvo (Pessoa) - N√£o obrigat√≥rio: ");
                                target = read.question();
                                
                                typeDescription = dataTypesPotions.find(t => t.code === type)?.description || "";
    
                                potions.updatePotion(
                                    new LovePotion(id, name, description, typeDescription, quantity, flavor, principalEffect, sideEffects, howToUse, ingredients, price, romanticIntensity, target)
                                );
                                break;
                            
                            case "Po√ß√µes de Caos":
                                console.log("Digite o n√≠vel de destrui√ß√£o: 1-10");
                                destructionLevel = read.questionInt();
    
                                console.log("Digite a dura√ß√£o do efeito: 1-5");
                                effectDuration = read.questionInt();
    
                                typeDescription = dataTypesPotions.find(t => t.code === type)?.description || "";
    
                                potions.updatePotion(
                                    new ChaosPotion(id, name, description, typeDescription, quantity, flavor, principalEffect, sideEffects, howToUse, ingredients, price, destructionLevel, effectDuration)
                                );
                                break;
                            
                            case "Po√ß√µes de Melancolia":
                                console.log("Digite a profundidade emocional: 1-5");
                                emotionalDepth = read.questionInt();
    
                                console.log("Digite os gatilhos: ");
                                memoryTrigger = read.question();
    
                                typeDescription = dataTypesPotions.find(t => t.code === type)?.description || "";
    
                                potions.updatePotion(
                                    new MelancholyPotion(id, name, description, typeDescription, quantity, flavor, principalEffect, sideEffects, howToUse, ingredients, price, emotionalDepth, memoryTrigger)
                                );
                                break;
                            
                            case "Po√ß√µes de Coragem":
                                console.log("Digite o b√¥nus de aud√°cia: 1-10");
                                audacityBonus = read.questionInt();
    
                                console.log("Digite os efeitos: ");
                                sideEffect = read.question();
    
                                typeDescription = dataTypesPotions.find(t => t.code === type)?.description || "";
    
                                potions.updatePotion(
                                    new CouragePotion(id, name, description, typeDescription, quantity, flavor, principalEffect, sideEffects, howToUse, ingredients, price, audacityBonus, sideEffect)
                                );
                                break;
                            
                            case "Po√ß√µes de Distor√ß√£o Temporal":
                                console.log("Digite o fator dilata√ß√£o: 1-5");
                                timeDilationFactor = read.questionInt();
    
                                console.log("Digite os paradoxos poss√≠veis: ");
                                possibleParadoxes = read.question();
    
                                typeDescription = dataTypesPotions.find(t => t.code === type)?.description || "";
    
                                potions.updatePotion(
                                    new TimeDilationPotion(id, name, description, typeDescription, quantity, flavor, principalEffect, sideEffects, howToUse, ingredients, price, timeDilationFactor, possibleParadoxes)
                                );
                                break;
                        }
    
                    } else {
                        console.log(`A po√ß√£o n√∫mero: ${id} n√£o foi encontrada!`);
                    }
                    break;
                
                case 5:
                    console.log("Digite o n√∫mero da po√ß√£o: ")
                    id = read.questionInt();
    
                    potions.deletePotion(id);
                    break;
                
                default:
                    break;
            }
        }
    } catch (error) {
        throw new Error(`Erro ao rodar o projeto! => ${(error as Error).message}`);
    }
}

